<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculation History</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center font-[Inter]">
    <div class="calculator-container p-6 bg-white shadow-xl rounded-lg max-w-sm w-full mx-4 sm:mx-0">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">Calculation History</h1>
        <div id="history-list" class="space-y-2 mb-4 max-h-80 overflow-y-auto">
            <!-- History items will be dynamically inserted here -->
        </div>
        <a href="{% url 'index' %}" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg transition duration-300 transform hover:scale-105 text-center">
            Back to Home
        </a>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const fetchHistory = async () => {
                try {
                    const response = await fetch('/api/history/');
                    if (!response.ok) {
                        throw new Error('Failed to fetch history');
                    }
                    const data = await response.json();
                    const historyList = document.getElementById('history-list');
                    historyList.innerHTML = '';
                    
                    if (data.length === 0) {
                        historyList.innerHTML = '<p class="text-center text-gray-500">No history to display.</p>';
                        return;
                    }

                    data.forEach(item => {
                        const historyItem = document.createElement('div');
                        historyItem.className = 'history-item p-3 bg-gray-200 rounded-lg flex justify-between items-center';
                        historyItem.innerHTML = `
                            <div class="text-gray-700">
                                <span class="font-semibold">${item.expression} =</span>
                                <span class="font-bold text-gray-900">${item.result}</span>
                            </div>
                            <div class="text-xs text-gray-500">${new Date(item.timestamp).toLocaleString()}</div>
                        `;
                        historyList.appendChild(historyItem);
                    });
                } catch (error) {
                    const historyList = document.getElementById('history-list');
                    historyList.innerHTML = `<p class="text-red-500 text-center">Error: ${error.message}</p>`;
                }
            };
            fetchHistory();
        });
    </script>
</body>
</html>
